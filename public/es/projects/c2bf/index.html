<!DOCTYPE html>
<html lang="es" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>¿C? Reescríbelo en Brainfuck. | iacgm</title>
<meta name="keywords" content="">
<meta name="description" content="C2BF: Un Compilador de C a Brainfuck.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/es/projects/c2bf/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b489a6d73b9d5f542e10296b5fbfe24c07a73618c7ca7efba908fadedc6200f9.css" integrity="sha256-tImm1zudX1QuEClrX7/iTAenNhjHyn77qQj63txiAPk=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/projects/c2bf/">
<link rel="alternate" hreflang="es" href="http://localhost:1313/es/projects/c2bf/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script>
    (function(w,d,e,u,f,l,n){w[f]=w[f]||function(){(w[f].q=w[f].q||[])
    .push(arguments);},l=d.createElement(e),l.async=1,l.src=u,
    n=d.getElementsByTagName(e)[0],n.parentNode.insertBefore(l,n);})
    (window,document,'script','https://assets.mailerlite.com/js/universal.js','ml');
    ml('account', '1864484');
</script>


</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/es/" accesskey="h" title="iacgm (Alt + H)">iacgm</a>
            <div class="logo-switches">
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="http://localhost:1313/" title="English"
                            aria-label="English">En</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/es/search/" title="Buscar">
                    <span>Buscar</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/es/projects/" title="Proyectos">
                    <span>Proyectos</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/es/index.xml" title="RSS">
                    <span>RSS</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      ¿C? Reescríbelo en Brainfuck.
    </h1>
    <div class="post-meta"><span title='2025-10-01 00:00:00 +0000 UTC'>1 de octubre de 2025</span>&nbsp;·&nbsp;13 min&nbsp;|&nbsp;Traducciones:
<ul class="i18n_list">
    <li>
        <a href="http://localhost:1313/projects/c2bf/">En</a>
    </li>
</ul>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Tabla de Contenidos</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#haciendo-las-cosas-peor" aria-label="Haciendo las Cosas Peor">Haciendo las Cosas Peor</a></li>
                <li>
                    <a href="#sem%c3%a1ntica-de-brainfuck" aria-label="Semántica de Brainfuck">Semántica de Brainfuck</a></li>
                <li>
                    <a href="#introducci%c3%b3n-a-los-compiladores" aria-label="Introducción a los Compiladores">Introducción a los Compiladores</a></li>
                <li>
                    <a href="#an%c3%a1lisis-l%c3%a9xico-y-sint%c3%a1ctico" aria-label="Análisis Léxico y Sintáctico">Análisis Léxico y Sintáctico</a><ul>
                        
                <li>
                    <a href="#generaci%c3%b3n-de-ir" aria-label="Generación de IR">Generación de IR</a></li>
                <li>
                    <a href="#traducci%c3%b3n-a-brainfuck" aria-label="Traducción a Brainfuck">Traducción a Brainfuck</a></li>
                <li>
                    <a href="#optimizaci%c3%b3n-local" aria-label="Optimización Local">Optimización Local</a></li></ul>
                </li>
                <li>
                    <a href="#limitaciones" aria-label="Limitaciones">Limitaciones</a></li>
                <li>
                    <a href="#proyectos-similares" aria-label="Proyectos Similares">Proyectos Similares</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="haciendo-las-cosas-peor">Haciendo las Cosas Peor<a hidden class="anchor" aria-hidden="true" href="#haciendo-las-cosas-peor">#</a></h2>
<p>La gente siempre parece querer hacer las cosas bien, y cuando fracasa, tiende a culpar a sus herramientas. Así que no debería sorprender que los programadores, siendo algo parecidos a las personas (y generalmente malos en lo que hacen), tengan una larga tradición de desarrollar un celo casi religioso por editores, paradigmas, estilos de código y, por supuesto, lenguajes de programación. Las discusiones nunca terminan, y lo que uno predica, otro <a href="https://en.wikipedia.org/wiki/Considered_harmful">lo considera dañino</a>.</p>
<ul>
<li>
<p>&ldquo;<em>La tipificación estática solo estorba</em>&rdquo;, dice una voz, &ldquo;<em>Python me deja simplemente programar.</em>&rdquo;</p>
</li>
<li>
<p>&ldquo;<em>El verificador de préstamos no es <strong>tan</strong> malo una vez que te acostumbras</em>&rdquo;, responde otro, cuya camiseta dice &ldquo;<em>Reescríbelo en Rust</em>&rdquo;.</p>
</li>
<li>
<p>&ldquo;<em>Diviértete con tus bucles y estado mutable</em>&rdquo;, se burla un tercero, &ldquo;<em>vuelve cuando aprendas lo que es una mónada.</em>&rdquo;</p>
</li>
</ul>
<p>Es exactamente como Boris Marshalov describía al Congreso Estadounidense:
&ldquo;Un hombre se levanta para hablar y no dice nada. Nadie escucha—y luego todos están en desacuerdo.&rdquo;</p>
<p>Pero de repente, milagrosamente, desde los cielos, oímos las voces sabias y atronadoras de <a href="https://es.wikipedia.org/wiki/Tesis_de_Church-Turing">Church y Turing</a> al unísono, trayendo claridad en medio del ruido:
&ldquo;Simplemente no importa&rdquo;, dicen, &ldquo;En buenas manos, todos son equivalentes.&rdquo;</p>
<p>Pero, ¿y si no eres el tipo de persona que quiere hacer las cosas bien? ¿Y si eres del tipo que quiere hacerlas mal? ¿Y si quieres hacer las cosas <strong><em>peor</em></strong>?</p>
<p>En ese caso, podrías tener algo en común con Urban Müller, quien en 1993<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, presumiblemente incapaz de aceptar la doctrina de Church-Turing, creó <strong>Brainfuck</strong>, un lenguaje tan atroz que ningún otro nombre podría hacerle justicia. Con sólo 8 instrucciones y sin soporte para variables, funciones, memoria de acceso aleatorio, tipos de datos, aritmética fraccional, gestión de memoria ni ningún tipo de flujo de control convencional (!), seguramente <em>esta</em> abominación no podría compararse con (digamos) C, la &ldquo;lingua franca&rdquo; del mundo digital, usada en casi todos los dispositivos de los últimos 50 años.</p>
<p>&ldquo;Hello World&rdquo; en Brainfuck, para los no iniciados, se ve así:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-brainfuck" data-lang="brainfuck"><span style="display:flex;"><span>++++++++<span style="color:#66d9ef">[</span>&gt;++++<span style="color:#66d9ef">[</span>&gt;++&gt;+++&gt;+++&gt;+&lt;&lt;&lt;&lt;-<span style="color:#66d9ef">]</span>&gt;+&gt;+&gt;-&gt;&gt;+<span style="color:#66d9ef">[</span>&lt;<span style="color:#66d9ef">]</span>&lt;-<span style="color:#66d9ef">]</span>&gt;&gt;<span style="color:#f92672">.</span>&gt;---<span style="color:#f92672">.</span>+++++++<span style="color:#f92672">..</span>+++<span style="color:#f92672">.</span>&gt;&gt;<span style="color:#f92672">.</span>&lt;-<span style="color:#f92672">.</span>&lt;<span style="color:#f92672">.</span>+++<span style="color:#f92672">.</span>------<span style="color:#f92672">.</span>--------<span style="color:#f92672">.</span>&gt;&gt;+<span style="color:#f92672">.</span>&gt;++<span style="color:#f92672">.</span><span style="color:#75715e">
</span></span></span></code></pre></div><p>Durante los últimos 30 años, Brainfuck se ha convertido en una especie de broma recurrente entre programadores. Les gusta señalarlo y quedarse mirando, diciendo con misticismo y asombro:
&ldquo;<em>Brainfuck puede parecer un desastre, pero es Turing Completo: puedes programar cualquier cosa que quieras en Brainfuck.</em>&rdquo;
Pero no puedes programar cualquier cosa que quieras en Brainfuck, porque Brainfuck es difícil, y tú no eres tan listo.</p>
<p>Pero <strong><em>yo</em></strong> sí.</p>
<p><strong><em>Yo</em></strong> sí puedo hacer casi cualquier cosa que quiera en Brainfuck.
Por ejemplo, considera <a href="/donut.bf">esta creación mía reciente en Brainfuck</a>, que muestra una animación de una dona girando:</p>
<p><img alt="ASCII Donut" loading="lazy" src="/donut.png#center"></p>
<p>Si esto te resulta familiar, es porque es una versión (ligeramente modificada) del famoso programa en C de Andy Sloane, <a href="https://www.a1k0n.net/2011/07/20/donut-math.html">donut.c</a>, traducido a Brainfuck.</p>
<p>No, no escribí yo mismo las 125,489 instrucciones de esto. Sino, pasé 6 semanas creando <a href="https://github.com/iacgm/c2bf">un compilador de C a Brainfuck</a>, y luego modifiqué donut.c para que utilice aritmética de punto fijo de muy baja precisión.</p>
<p>Mi compilador admite casi todas las características principales de C, incluyendo:</p>
<ul>
<li>Aritmética de enteros</li>
<li>Variables locales y globales</li>
<li>Bucles y sentencias if</li>
<li>Arreglos (arrays)</li>
<li>Funciones (y recursión)</li>
<li>Punteros</li>
<li>Punteros a función (!)</li>
</ul>
<p>He aquí cómo lo hice.</p>
<h2 id="semántica-de-brainfuck">Semántica de Brainfuck<a hidden class="anchor" aria-hidden="true" href="#semántica-de-brainfuck">#</a></h2>
<p>Antes de analizar el compilador en sí, vale la pena repasar la semántica de Brainfuck.</p>
<p>Comenzamos con una cinta infinita de celdas, cada una conteniendo el número cero. Tenemos un cabezal de cinta que apunta a la primera de estas celdas. Además, contamos con ocho instrucciones, cada una con su propio símbolo:</p>
<ol>
<li><code>+</code>: Incrementa la celda bajo el cabezal de cinta.</li>
<li><code>-</code>: Decrementa la celda bajo el cabezal de cinta.</li>
<li><code>&gt;</code>: Mueve el cabezal de cinta a la derecha.</li>
<li><code>&lt;</code>: Mueve el cabezal de cinta a la izquierda.</li>
<li><code>,</code>: Almacena el siguiente carácter de la entrada en la celda bajo el cabezal de cinta.</li>
<li><code>.</code>: Imprime el valor almacenado en la celda bajo el cabezal de cinta.</li>
<li><code>[</code>: Si el cabezal de cinta apunta a un cero, salta al <code>]</code> correspondiente.</li>
<li><code>]</code>: Si el cabezal de cinta <strong>no</strong> apunta a un cero, salta al <code>[</code> correspondiente.</li>
</ol>
<p>Esencialmente, los bloques <code>[</code>/<code>]</code> funcionan como bucles <code>while-no-cero</code>.</p>
<p>Eso es todo. En serio.</p>
<h2 id="introducción-a-los-compiladores">Introducción a los Compiladores<a hidden class="anchor" aria-hidden="true" href="#introducción-a-los-compiladores">#</a></h2>
<p>Este compilador no es realmente muy diferente de cualquier otro, por lo que resulta una buena base para aprender los fundamentos de los compiladores en general. Todo lo que hace un compilador es traducir un lenguaje a otro, con algunos pasos intermedios. Esto se realiza en una serie de pasos de traducción, cada uno de los cuales nos lleva un poco más lejos en el camino desde el código fuente hasta el lenguaje objetivo. En mi compilador, las etapas son:</p>
<ol>
<li><strong>Análisis Léxico</strong>: Este paso convierte un flujo de caracteres en tokens. Es decir, divide nuestro código en palabras clave, identificadores, símbolos, etc.</li>
<li><strong>Análisis Sintáctico</strong>: Este paso convierte un flujo de tokens en un Árbol de Sintaxis Abstracta (AST). Es decir, divide nuestro código en construcciones: expresiones, declaraciones, definiciones, etc.</li>
<li><strong>Generación de Código Intermedio</strong>: En esta etapa, convertimos nuestro AST en una Representación Intermedia (IR). Es decir, un lenguaje que cierra la brecha entre C y Brainfuck. Debería ser algo fácil de traducir tanto hacia como desde este.</li>
<li><strong>Generación de Código BF</strong>: En esta etapa, traducimos cada instrucción IR a Brainfuck.</li>
<li><strong>Optimización Local</strong>: Este paso no es estrictamente necesario, pero para lograr velocidades de ejecución razonables, necesitaremos que nuestro intérprete de Brainfuck reconozca ciertos patrones comunes en Brainfuck que pueden acelerarse o incluso omitirse por completo.</li>
</ol>
<h2 id="análisis-léxico-y-sintáctico">Análisis Léxico y Sintáctico<a hidden class="anchor" aria-hidden="true" href="#análisis-léxico-y-sintáctico">#</a></h2>
<p>Este es, más o menos, un problema resuelto. Esta es la única parte de este proyecto en la que utilicé una biblioteca externa, Pest. Esto nos permite especificar nuestra gramática (en este caso, <a href="https://www.quut.com/c/ANSI-C-grammar-l-1999.html">una gramática C99</a> ligeramente modificada<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>) en algo más parecido a <a href="https://es.wikipedia.org/wiki/Notaci%C3%B3n_de_Backus-Naur">la Forma de Backus-Naur</a>. Por ejemplo:</p>
<pre tabindex="0"><code class="language-pest" data-lang="pest">if_stmt = { &#34;if&#34; ~ &#34;(&#34; ~ expr ~ &#34;)&#34; ~ stmt ~ (&#34;else&#34; ~ stmt)? }
</code></pre><p>Una vez que Pest ha construido un árbol de análisis, podemos construir nuestro AST directamente. Por ejemplo, nuestra estructura de declaración if se ve así:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">Stmt</span> {
</span></span><span style="display:flex;"><span>  IfStmt(Expr, Box<span style="color:#f92672">&lt;</span>Stmt<span style="color:#f92672">&gt;</span>, Option<span style="color:#f92672">&lt;</span>Box<span style="color:#f92672">&lt;</span>Stmt<span style="color:#f92672">&gt;&gt;</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// ... otros tipos de declaraciones
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>Lo mismo puede hacerse para otras construcciones, esencialmente de manera mecánica.</p>
<h3 id="generación-de-ir">Generación de IR<a hidden class="anchor" aria-hidden="true" href="#generación-de-ir">#</a></h3>
<p>Aquí es donde ocurre la verdadera magia. Pero antes de analizar el proceso de generación de código, es importante considerar cómo se verá el IR. Nuestro lenguaje IR debe tener en cuenta que Brainfuck no tiene memoria de acceso aleatorio, por lo que cada decisión sobre dónde almacenamos cada valor creará obstáculos tangibles y difíciles al traducir a Brainfuck.</p>
<p>Esto es un rompecabezas que te animo a considerar. Encontrar una solución para este problema fue lo que me inspiró a trabajar en este proyecto.</p>
<p>La idea es utilizar un IR basado en <a href="https://es.wikipedia.org/wiki/Pila_%28inform%C3%A1tica%29">pila</a>. Esto significa que nuestras instrucciones no tomarán argumentos, sino que operarán sobre una única pila. Así, al traducir a Brainfuck, (en su mayoría) no tendremos que recuperar argumentos de la memoria.</p>
<p>Por ejemplo, consideremos la sentencia:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">putchar</span>(<span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>);
</span></span></code></pre></div><p>Usando un IR basado en registros, obtendríamos algo como:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">r0</span>, <span style="color:#ae81ff">48</span>     <span style="color:#75715e">; 48 es &#39;0&#39; en ASCII
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">r1</span>, <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">r2</span>, <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mul</span> <span style="color:#66d9ef">r1</span>, <span style="color:#66d9ef">r1</span>, <span style="color:#66d9ef">r2</span> <span style="color:#75715e">; multiplica r1 y r2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">add</span> <span style="color:#66d9ef">r0</span>, <span style="color:#66d9ef">r0</span>, <span style="color:#66d9ef">r1</span> <span style="color:#75715e">; suma r1 a r0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">putchar</span> <span style="color:#66d9ef">r0</span>     <span style="color:#75715e">; ... según la convención de E/S
</span></span></span></code></pre></div><p>Pero nuestro IR basado en pila no tiene argumentos (no constantes). En su lugar, cada argumento actúa sobre los resultados de los anteriores:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">Push</span>(<span style="color:#ae81ff">48</span>) <span style="color:#75715e">; la pila queda [48]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">Push</span>(<span style="color:#ae81ff">3</span>)  <span style="color:#75715e">; la pila queda [48, 3]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">Push</span>(<span style="color:#ae81ff">2</span>)  <span style="color:#75715e">; la pila queda [48, 3, 2]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">Mul</span>      <span style="color:#75715e">; la pila queda [48, 6]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">Add</span>      <span style="color:#75715e">; la pila queda [54]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">PutChar</span>  <span style="color:#75715e">; la pila queda []
</span></span></span></code></pre></div><p>Continuando con nuestro ejemplo de la sentencia <code>if</code>, el nodo AST <code>If(cond, then, else)</code> se convertiría en algo como:</p>
<pre tabindex="0"><code class="language-ir" data-lang="ir">; [IR para `cond`]
Branch(L1, L2) ; Salta a L1 si cond es verdadero, a L2 en caso contrario
Label(L1)
; [IR para `then`]
GoTo(L3)
Label(L2)
; [IR para `else`]
Label(L3)
</code></pre><p>Nótese que, aunque estas instrucciones toman argumentos, todos son constantes. Nunca tenemos que leer memoria aparte de los valores en la cima de la pila.</p>
<h3 id="traducción-a-brainfuck">Traducción a Brainfuck<a hidden class="anchor" aria-hidden="true" href="#traducción-a-brainfuck">#</a></h3>
<p>El IR basado en pila es especialmente conveniente porque la semántica de Brainfuck básicamente nos proporciona una pila en forma de cinta. Podemos pensar que el cabezal de la cinta apunta a la cima de la pila, y las celdas a su izquierda contienen los valores de la pila. Debemos mantener las celdas a la derecha del cabezal vacías para usarlas según sea necesario. Con este enfoque, traducir nuestras primeras instrucciones es pan comido. Por ejemplo:</p>
<ol>
<li>
<p><code>Push(5)</code>: <code>&gt;+++++</code>
Simplemente movemos el cabezal e incrementamos la nueva celda 5 veces.</p>
</li>
<li>
<p><code>Add</code>: <code>[-&lt;+&gt;]&lt;</code>
Un poco más complicado, pero no demasiado. Si <code>x</code> e <code>y</code> son nuestros argumentos, decrementamos <code>x</code> e incrementamos <code>y</code> repetidamente hasta que <code>x</code> sea cero. Luego, movemos el cabezal atrás una celda para liberar espacio en la pila.</p>
</li>
<li>
<p><code>Store(3)</code>: <code>&lt;&lt;&lt;[-]&gt;&gt;&gt;[-&lt;&lt;&lt;+&gt;&gt;&gt;]&lt;</code>
Para mover un valor de la cima de la pila a una posición más abajo, limpiamos esa ranura, sumamos el valor de la cima y movemos el cabezal de vuelta.</p>
</li>
<li>
<p><code>GoTo</code>: Mmm&hellip; Aunque las operaciones aritméticas básicas pueden implementarse con traducciones directas<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>, implementar los saltos necesarios para el flujo de control general (o para punteros a función) es más complicado.</p>
</li>
</ol>
<p>Nuevamente, te animo a detenerte y reflexionar sobre esto. Es otro rompecabezas interesante.</p>
<p>Esta vez, la idea es usar una transformación de programa completo. Podemos envolver todo el programa en un bucle <code>[</code>/<code>]</code> y luego controlar cada bloque de código ensamblador con una sentencia condicional. De esta manera, solo necesitamos implementar un tipo simple de flujo de control en Brainfuck. Por ejemplo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>a:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Bloque A
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">goto</span> c;
</span></span><span style="display:flex;"><span>b:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Bloque B
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">exit</span>();
</span></span><span style="display:flex;"><span>c:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Bloque C
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">goto</span> b;
</span></span></code></pre></div><p>&hellip; puede reescribirse como &hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> etiqueta <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> (etiqueta <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (etiqueta <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;a&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Bloque A
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    etiqueta <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;c&#39;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (etiqueta <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;b&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Bloque B
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    etiqueta <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (etiqueta <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;c&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Bloque C
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    etiqueta <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;b&#39;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Implementar verificaciones de igualdad, bucles while-no-cero y sentencias condicionales en Brainfuck son problemas, si no fáciles, al menos manejables.</p>
<p>En cuanto a las lecturas y escrituras de punteros, no intentaré explicarlas, más allá de enlazar este <a href="https://www.inshame.com/2008/02/efficient-brainfuck-tables.html">excelente artículo</a>.</p>
<h3 id="optimización-local">Optimización Local<a hidden class="anchor" aria-hidden="true" href="#optimización-local">#</a></h3>
<p>Aunque los pasos anteriores nos permiten compilar programas Brainfuck funcionales, no están cerca de ser óptimos. Solo mirando un fragmento de nuestro código donut.bf, vemos todo tipo de código subóptimo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-brainfuck" data-lang="brainfuck"><span style="display:flex;"><span>+&lt;<span style="color:#66d9ef">[[</span>-<span style="color:#66d9ef">]</span>&gt;-&lt;<span style="color:#66d9ef">]</span>&gt;<span style="color:#66d9ef">[</span>-&lt;+&gt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">[</span>-&lt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>&lt;&gt;&gt;+&gt;+++++++++++++++<span style="color:#66d9ef">[</span>-&lt;<span style="color:#66d9ef">[</span>-&gt;&gt;+&gt;+&lt;&lt;&lt;<span style="color:#66d9ef">]</span>&gt;&gt;<span style="color:#66d9ef">[</span>-&lt;&lt;<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>+&gt;&gt;<span style="color:#66d9ef">]</span>&gt;<span style="color:#66d9ef">[</span>-&lt;&lt;&lt;+&gt;&gt;&gt;<span style="color:#66d9ef">]</span>&lt;&lt;<span style="color:#66d9ef">]</span>&lt;&lt;&lt;<span style="color:#66d9ef">[</span>-&gt;&gt;&gt;+&gt;+&lt;&lt;&lt;&lt;<span style="color:#66d9ef">]</span>&gt;&gt;&gt;&gt;<span style="color:#66d9ef">[</span>-&lt;&lt;&lt;&lt;+&gt;&gt;&gt;&gt;<span style="color:#66d9ef">]</span>&lt;&gt;&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">[</span>&lt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">[</span>-&gt;&gt;<span style="color:#66d9ef">[</span>&gt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">[</span>--<span style="color:#66d9ef">[</span>++++<span style="color:#66d9ef">[</span>-&gt;<span style="color:#66d9ef">]</span>&gt;<span style="color:#66d9ef">]</span>++&lt;<span style="color:#66d9ef">]</span>&gt;--&lt;&lt;<span style="color:#66d9ef">[</span>&lt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">[</span>-&gt;+&lt;<span style="color:#66d9ef">]</span>&gt;&gt;&gt;<span style="color:#66d9ef">[</span>&gt;<span style="color:#66d9ef">]</span>+&gt;<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>+&gt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">[</span>&lt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">[</span>-&gt;&gt;<span style="color:#66d9ef">[</span>&gt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">[</span>--<span style="color:#66d9ef">[</span>++++<span style="color:#66d9ef">[</span>-&gt;<span style="color:#66d9ef">]</span>&gt;<span style="color:#66d9ef">]</span>++&lt;<span style="color:#66d9ef">]</span>&gt;--&lt;&lt;<span style="color:#66d9ef">[</span>&lt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">]</span>&gt;&gt;<span style="color:#66d9ef">[</span>&gt;<span style="color:#66d9ef">]</span>++++<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>++++++++++++<span style="color:#66d9ef">[</span>-&lt;<span style="color:#66d9ef">[</span>-&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;+&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span style="color:#66d9ef">]</span>&gt;<span style="color:#66d9ef">[</span>-&lt;+&gt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">[</span>&lt;<span style="color:#66d9ef">]</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>&lt;+&gt;&gt;<span style="color:#66d9ef">[</span>&gt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">[</span>&gt;+&lt;----<span style="color:#66d9ef">[[</span>-<span style="color:#66d9ef">]</span>&gt;-&lt;<span style="color:#66d9ef">]</span>&gt;<span style="color:#66d9ef">[</span>-&lt;&lt;<span style="color:#66d9ef">[</span>&lt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">[</span>-&lt;+&gt;&gt;+&lt;<span style="color:#66d9ef">]</span>&gt;<span style="color:#66d9ef">[</span>-&lt;+&gt;<span style="color:#66d9ef">]</span>&gt;<span style="color:#66d9ef">[</span>&gt;<span style="color:#66d9ef">]</span>&gt;<span style="color:#66d9ef">]</span>&lt;&lt;<span style="color:#66d9ef">[</span>&lt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">[</span>-&gt;<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>++&lt;<span style="color:#66d9ef">]</span>&gt;<span style="color:#66d9ef">[</span>-&lt;+&gt;<span style="color:#66d9ef">]</span>&gt;&gt;<span style="color:#66d9ef">[</span>&gt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">]</span>&lt;&lt;&lt;&lt;<span style="color:#66d9ef">[</span>-<span style="color:#66d9ef">]</span>&gt;<span style="color:#66d9ef">[</span>-&lt;+&gt;<span style="color:#66d9ef">]</span>&lt;<span style="color:#66d9ef">[</span>-&gt;+&gt;+&lt;&lt;<span style="color:#66d9ef">]</span>&gt;&gt;<span style="color:#66d9ef">[</span>-&lt;&lt;+&gt;&gt;<span style="color:#66d9ef">]</span>&lt;&gt;++++++++++<span style="color:#75715e">
</span></span></span></code></pre></div><p>Por todas partes vemos secuencias como <code>&lt;&gt;</code> o <code>&gt;&lt;</code>, que pueden eliminarse por completo. Peor aún, también encontramos código lento <em>pero óptimo</em>, como largas cadenas de instrucciones <code>&gt;/&lt;</code> y <code>+/-</code>, secciones <code>[-]</code> y bloques de &ldquo;movimiento&rdquo; (es decir, bloques que limpian una celda y suman o restan su valor de otras celdas, como <code>[-&lt;+&gt;]</code> o <code>[-&gt;&gt;+&gt;+&lt;&lt;&lt;]</code>).</p>
<p>Estos patrones no son difíciles de detectar, y hacerlo nos permite saltarnos y ejecutar grandes bloques de código de una sola vez. Esto acelera masivamente nuestro código. Por ejemplo, sumar 100 a 100 normalmente tomaría about 600 instrucciones, pero se convierte en una sola instrucción.</p>
<p>Intenté renderizar un solo fotograma de donut.c sin estas optimizaciones, pero abandoné después de about 20 horas porque mi portátil comenzó a sobrecalentarse tanto que la pantalla dejó de responder. Un cálculo rápido mostraba que podría haber esperado about 6 horas más en mi máquina.</p>
<p>Con estas optimizaciones, podemos renderizar un fotograma en about 90 minutos.</p>
<p>Podemos llevar esto aún más lejos, porque un análisis de rendimiento revela que solo un pequeño número de instrucciones complejas consumen casi todo nuestro tiempo de ejecución. Después de usar un truco similar para detectar el código que genero para instrucciones complejas como operaciones bit a bit, multiplicaciones, divisiones y accesos a memoria (efectivamente descompilándolas de vuelta a IR en tiempo de ejecución), puedo renderizar un fotograma en about 12 minutos<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>.</p>
<p>Sí, este último truco es básicamente hacer trampa.
No, realmente no me importa.</p>
<h2 id="limitaciones">Limitaciones<a hidden class="anchor" aria-hidden="true" href="#limitaciones">#</a></h2>
<p>Faltan algunas características, pero en su mayoría no serían difíciles de agregar. El factor limitante fue que, en este punto, el proyecto pasó de ser divertido y educativo a consumir mucho tiempo y volverse tedioso.</p>
<p>Algunas características importantes que faltan son:</p>
<ul>
<li>Soporte para funciones variádicas (incluyendo <code>printf</code>).</li>
<li>Funciones de biblioteca estándar en general.</li>
<li>Tipos de diferentes tamaños (aparte de arreglos). La mayoría de los intérpretes de Brainfuck usan celdas de 1 byte. El mío usa celdas de 2 bytes para que sean lo suficientemente grandes como para almacenar las etiquetas a las que saltar, y para tener suficiente precisión para implementar una aritmética de punto fijo utilizable.</li>
<li>Sentencias <code>switch</code>. Sin excusas aquí, simplemente me volví un poco perezoso.</li>
<li>Asignación de memoria / arreglos de longitud variable. Esta sería una adición complicada, ya que tendríamos que cambiar cómo accedemos a las variables globales, pero no estaría fuera de nuestro alcance.</li>
</ul>
<h2 id="proyectos-similares">Proyectos Similares<a hidden class="anchor" aria-hidden="true" href="#proyectos-similares">#</a></h2>
<p>Después de completar este proyecto e investigar un poco, descubrí que la idea para este proyecto, como cualquier buena idea, ha sido concebida varias veces antes. Sin embargo, aunque definitivamente elogio a cualquiera que asuma el importante trabajo de construir un compilador de X-a-Brainfuck, creo que mi enfoque distingue a este proyecto de otros.</p>
<p>Existen varios proyectos (como el descrito <a href="https://www.quut.com/c/ANSI-C-grammar-l-1999.html">aquí</a>) que pueden traducir comandos simples e incluso bucles, pero no admiten cosas como llamadas a funciones. El artículo enlazado incluso llega a describir el truco de salto que usé, pero dice que sería demasiado difícil de implementar.</p>
<p>Los únicos que he encontrado que son tan completos como el mío son aquellos que funcionan, pero se parecen más a emuladores escritos en Brainfuck que a transpiladores. Es decir, en lugar de traducir el código directamente, actúan como máquinas virtuales, colocando instrucciones en memoria y luego ejecutando cada una independientemente, simulando memoria tradicional y registros. <a href="https://github.com/shinh/elvm">ELVM</a> es un proyecto que se dirige a muchos lenguajes esotéricos, pero la implementación de BF es esencialmente un emulador. Gregor Richards tiene <a href="https://esolangs.org/wiki/C2BF">otro proyecto</a> que es explícitamente un emulador.</p>
<p>No hay nada malo con los emuladores, pero siento que mi enfoque ofrece una traducción más &ldquo;auténtica&rdquo; (lo que sea que eso signifique), y la IR basada en pila es realmente el ingrediente secreto para eso. Probablemente también es mucho más rápido, ya que solo necesitamos ejecutar realmente cada instrucción, en lugar de cargar instrucciones desde memoria y lidiar con contadores de programa y registros, etc. Sin embargo, no los comparé, porque mi implementación está escrita en Rust, así que no importa lo lenta que sea, sigue siendo extremadamente rápida.</p>
<p>Así que adelante, prospera y pon Brainfuck en producción ;)</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Con un poco de ayuda de <a href="https://es.wikipedia.org/wiki/P%E2%80%B2%E2%80%B2">Bohm</a>.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Recomendaría encarecidamente a cualquiera que no lo haya hecho que examine detenidamente la gramática de C, o que al menos consulte la referencia de Microsoft sobre C (o el Estándar de C, aunque esto no es para los débiles de corazón). C está lleno de peculiaridades interesantes que de otro modo podrías nunca encontrar, y si hay algo que construir un compilador te obliga a hacer, es a aprender tu lenguaje de verdad, de manera profunda.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>&ldquo;Directo&rdquo; no significa &ldquo;simple&rdquo;; intenta implementar operaciones bit a bit sin multiplicación o división. Incluso las comparaciones de números sin signo son altamente complejas. Si te interesa, puedes consultar <a href="https://esolangs.org/wiki/Brainfuck_algorithms">estos ejemplos</a> como inspiración.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>Para poder hacer esto de forma segura, debemos asegurarnos de que siempre que veamos el código para una operación bit a bit (por ejemplo), realmente solo calcule un valor, sin efectos secundarios. Esto significa que debemos estar seguros de que todas las celdas de memoria que ese fragmento de código podría leer tienen los valores que esperamos. Podemos lograr esto haciendo que estas instrucciones limpien toda la memoria que necesiten antes de utilizar cualquier parte de ella.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul><div class="ml-embedded" data-form="hp55Js"></div>


  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/es/">iacgm</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
</body>

</html>
